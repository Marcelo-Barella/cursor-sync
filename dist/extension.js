"use strict";var De=Object.create;var at=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var _e=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var N=(s,t)=>()=>(s&&(t=s(s=0)),t);var _t=(s,t)=>{for(var e in t)at(s,e,{get:t[e],enumerable:!0})},Wt=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ge(t))!We.call(s,o)&&o!==e&&at(s,o,{get:()=>t[o],enumerable:!(n=Fe(t,o))||n.enumerable});return s};var v=(s,t,e)=>(e=s!=null?De(_e(s)):{},Wt(t||!s||!s.__esModule?at(e,"default",{value:s,enumerable:!0}):e,s)),Ke=s=>Wt(at({},"__esModule",{value:!0}),s);var Pt,zt,qe,qt=N(()=>{Pt=(s,t,e)=>{let n=s instanceof RegExp?zt(s,e):s,o=t instanceof RegExp?zt(t,e):t,i=n!==null&&o!=null&&qe(n,o,e);return i&&{start:i[0],end:i[1],pre:e.slice(0,i[0]),body:e.slice(i[0]+n.length,i[1]),post:e.slice(i[1]+o.length)}},zt=(s,t)=>{let e=t.match(s);return e?e[0]:null},qe=(s,t,e)=>{let n,o,i,a,r,u=e.indexOf(s),l=e.indexOf(t,u+1),f=u;if(u>=0&&l>0){if(s===t)return[u,l];for(n=[],i=e.length;f>=0&&!r;){if(f===u)n.push(f),u=e.indexOf(s,f+1);else if(n.length===1){let c=n.pop();c!==void 0&&(r=[c,l])}else o=n.pop(),o!==void 0&&o<i&&(i=o,a=l),l=e.indexOf(t,f+1);f=u<l&&u>=0?u:l}n.length&&a!==void 0&&(r=[i,a])}return r}});function Rt(s){return isNaN(s)?s.charCodeAt(0):parseInt(s,10)}function is(s){return s.replace(Ze,Jt).replace(ts,Xt).replace(es,Tt).replace(ss,Yt).replace(ns,Qt)}function rs(s){return s.replace(Je,"\\").replace(Xe,"{").replace(Ye,"}").replace(Qe,",").replace(Ve,".")}function Vt(s){if(!s)return[""];let t=[],e=Pt("{","}",s);if(!e)return s.split(",");let{pre:n,body:o,post:i}=e,a=n.split(",");a[a.length-1]+="{"+o+"}";let r=Vt(i);return i.length&&(a[a.length-1]+=r.shift(),a.push.apply(a,r)),t.push.apply(t,a),t}function Zt(s,t={}){if(!s)return[];let{max:e=os}=t;return s.slice(0,2)==="{}"&&(s="\\{\\}"+s.slice(2)),Y(is(s),e,!0).map(rs)}function as(s){return"{"+s+"}"}function cs(s){return/^-?0\d/.test(s)}function ls(s,t){return s<=t}function us(s,t){return s>=t}function Y(s,t,e){let n=[],o=Pt("{","}",s);if(!o)return[s];let i=o.pre,a=o.post.length?Y(o.post,t,!1):[""];if(/\$$/.test(o.pre))for(let r=0;r<a.length&&r<t;r++){let u=i+"{"+o.body+"}"+a[r];n.push(u)}else{let r=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(o.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(o.body),l=r||u,f=o.body.indexOf(",")>=0;if(!l&&!f)return o.post.match(/,(?!,).*\}/)?(s=o.pre+"{"+o.body+Tt+o.post,Y(s,t,!0)):[s];let c;if(l)c=o.body.split(/\.\./);else if(c=Vt(o.body),c.length===1&&c[0]!==void 0&&(c=Y(c[0],t,!1).map(as),c.length===1))return a.map(d=>o.pre+c[0]+d);let p;if(l&&c[0]!==void 0&&c[1]!==void 0){let d=Rt(c[0]),g=Rt(c[1]),h=Math.max(c[0].length,c[1].length),x=c.length===3&&c[2]!==void 0?Math.abs(Rt(c[2])):1,S=ls;g<d&&(x*=-1,S=us);let b=c.some(cs);p=[];for(let y=d;S(y,g);y+=x){let w;if(u)w=String.fromCharCode(y),w==="\\"&&(w="");else if(w=String(y),b){let C=h-w.length;if(C>0){let R=new Array(C+1).join("0");y<0?w="-"+R+w.slice(1):w=R+w}}p.push(w)}}else{p=[];for(let d=0;d<c.length;d++)p.push.apply(p,Y(c[d],t,!1))}for(let d=0;d<p.length;d++)for(let g=0;g<a.length&&n.length<t;g++){let h=i+p[d]+a[g];(!e||l||h)&&n.push(h)}}return n}var Jt,Xt,Tt,Yt,Qt,Je,Xe,Ye,Qe,Ve,Ze,ts,es,ss,ns,os,te=N(()=>{qt();Jt="\0SLASH"+Math.random()+"\0",Xt="\0OPEN"+Math.random()+"\0",Tt="\0CLOSE"+Math.random()+"\0",Yt="\0COMMA"+Math.random()+"\0",Qt="\0PERIOD"+Math.random()+"\0",Je=new RegExp(Jt,"g"),Xe=new RegExp(Xt,"g"),Ye=new RegExp(Tt,"g"),Qe=new RegExp(Yt,"g"),Ve=new RegExp(Qt,"g"),Ze=/\\\\/g,ts=/\\{/g,es=/\\}/g,ss=/\\,/g,ns=/\\./g,os=1e5});var Q,ee=N(()=>{Q=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")}});var fs,V,ps,se,ne,oe=N(()=>{fs={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},V=s=>s.replace(/[[\]\\-]/g,"\\$&"),ps=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),se=s=>s.join(""),ne=(s,t)=>{let e=t;if(s.charAt(e)!=="[")throw new Error("not in a brace expression");let n=[],o=[],i=e+1,a=!1,r=!1,u=!1,l=!1,f=e,c="";t:for(;i<s.length;){let h=s.charAt(i);if((h==="!"||h==="^")&&i===e+1){l=!0,i++;continue}if(h==="]"&&a&&!u){f=i+1;break}if(a=!0,h==="\\"&&!u){u=!0,i++;continue}if(h==="["&&!u){for(let[x,[S,m,b]]of Object.entries(fs))if(s.startsWith(x,i)){if(c)return["$.",!1,s.length-e,!0];i+=x.length,b?o.push(S):n.push(S),r=r||m;continue t}}if(u=!1,c){h>c?n.push(V(c)+"-"+V(h)):h===c&&n.push(V(h)),c="",i++;continue}if(s.startsWith("-]",i+1)){n.push(V(h+"-")),i+=2;continue}if(s.startsWith("-",i+1)){c=h,i+=2;continue}n.push(V(h)),i++}if(f<i)return["",!1,0,!1];if(!n.length&&!o.length)return["$.",!1,s.length-e,!0];if(o.length===0&&n.length===1&&/^\\?.$/.test(n[0])&&!l){let h=n[0].length===2?n[0].slice(-1):n[0];return[ps(h),!1,f-e,!1]}let p="["+(l?"^":"")+se(n)+"]",d="["+(l?"":"^")+se(o)+"]";return[n.length&&o.length?"("+p+"|"+d+")":n.length?p:d,r,f-e,!0]}});var G,ft=N(()=>{G=(s,{windowsPathsNoEscape:t=!1,magicalBraces:e=!0}={})=>e?t?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"):t?s.replace(/\[([^\/\\{}])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\{}])\]/g,"$1$2").replace(/\\([^\/{}])/g,"$1")});var T,hs,Mt,ie,ds,gs,ms,re,ys,pt,ws,Ss,xs,vs,Ot,ae,ce,bs,B,$t=N(()=>{oe();ft();hs=new Set(["!","?","+","*","@"]),Mt=s=>hs.has(s),ie=s=>Mt(s.type),ds=new Map([["!",["@"]],["?",["?","@"]],["@",["@"]],["*",["*","+","?","@"]],["+",["+","@"]]]),gs=new Map([["!",["?"]],["@",["?"]],["+",["?","*"]]]),ms=new Map([["!",["?","@"]],["?",["?","@"]],["@",["?","@"]],["*",["*","+","?","@"]],["+",["+","@","?","*"]]]),re=new Map([["!",new Map([["!","@"]])],["?",new Map([["*","*"],["+","*"]])],["@",new Map([["!","!"],["?","?"],["@","@"],["*","*"],["+","+"]])],["+",new Map([["?","*"],["*","*"]])]]),ys="(?!(?:^|/)\\.\\.?(?:$|/))",pt="(?!\\.)",ws=new Set(["[","."]),Ss=new Set(["..","."]),xs=new Set("().*{}+?[]^$\\!"),vs=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ot="[^/]",ae=Ot+"*?",ce=Ot+"+?",bs=0,B=class{type;#s;#n;#o=!1;#t=[];#e;#a;#l;#c=!1;#i;#r;#u=!1;id=++bs;get depth(){return(this.#e?.depth??-1)+1}[Symbol.for("nodejs.util.inspect.custom")](){return{"@@type":"AST",id:this.id,type:this.type,root:this.#s.id,parent:this.#e?.id,depth:this.depth,partsLength:this.#t.length,parts:this.#t}}constructor(t,e,n={}){this.type=t,t&&(this.#n=!0),this.#e=e,this.#s=this.#e?this.#e.#s:this,this.#i=this.#s===this?n:this.#s.#i,this.#l=this.#s===this?[]:this.#s.#l,t==="!"&&!this.#s.#c&&this.#l.push(this),this.#a=this.#e?this.#e.#t.length:0}get hasMagic(){if(this.#n!==void 0)return this.#n;for(let t of this.#t)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#n=!0;return this.#n}toString(){return this.#r!==void 0?this.#r:this.type?this.#r=this.type+"("+this.#t.map(t=>String(t)).join("|")+")":this.#r=this.#t.map(t=>String(t)).join("")}#y(){if(this!==this.#s)throw new Error("should only call on root");if(this.#c)return this;this.toString(),this.#c=!0;let t;for(;t=this.#l.pop();){if(t.type!=="!")continue;let e=t,n=e.#e;for(;n;){for(let o=e.#a+1;!n.type&&o<n.#t.length;o++)for(let i of t.#t){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(n.#t[o])}e=n,n=e.#e}}return this}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof T&&e.#e===this))throw new Error("invalid part: "+e);this.#t.push(e)}}toJSON(){let t=this.type===null?this.#t.slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...this.#t.map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#s||this.#s.#c&&this.#e?.type==="!")&&t.push({}),t}isStart(){if(this.#s===this)return!0;if(!this.#e?.isStart())return!1;if(this.#a===0)return!0;let t=this.#e;for(let e=0;e<this.#a;e++){let n=t.#t[e];if(!(n instanceof T&&n.type==="!"))return!1}return!0}isEnd(){if(this.#s===this||this.#e?.type==="!")return!0;if(!this.#e?.isEnd())return!1;if(!this.type)return this.#e?.isEnd();let t=this.#e?this.#e.#t.length:0;return this.#a===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new T(this.type,t);for(let n of this.#t)e.copyIn(n);return e}static#f(t,e,n,o,i){let a=o.maxExtglobRecursion??2,r=!1,u=!1,l=-1,f=!1;if(e.type===null){let h=n,x="";for(;h<t.length;){let S=t.charAt(h++);if(r||S==="\\"){r=!r,x+=S;continue}if(u){h===l+1?(S==="^"||S==="!")&&(f=!0):S==="]"&&!(h===l+2&&f)&&(u=!1),x+=S;continue}else if(S==="["){u=!0,l=h,f=!1,x+=S;continue}if(!o.noext&&Mt(S)&&t.charAt(h)==="("&&i<=a){e.push(x),x="";let b=new T(S,e);h=T.#f(t,b,h,o,i+1),e.push(b);continue}x+=S}return e.push(x),h}let c=n+1,p=new T(null,e),d=[],g="";for(;c<t.length;){let h=t.charAt(c++);if(r||h==="\\"){r=!r,g+=h;continue}if(u){c===l+1?(h==="^"||h==="!")&&(f=!0):h==="]"&&!(c===l+2&&f)&&(u=!1),g+=h;continue}else if(h==="["){u=!0,l=c,f=!1,g+=h;continue}if(!o.noext&&Mt(h)&&t.charAt(c)==="("&&(i<=a||e&&e.#p(h))){let S=e&&e.#p(h)?0:1;p.push(g),g="";let m=new T(h,p);p.push(m),c=T.#f(t,m,c,o,i+S);continue}if(h==="|"){p.push(g),g="",d.push(p),p=new T(null,e);continue}if(h===")")return g===""&&e.#t.length===0&&(e.#u=!0),p.push(g),g="",e.push(...d,p),c;g+=h}return e.type=null,e.#n=void 0,e.#t=[t.substring(n-1)],c}#w(t){return this.#d(t,gs)}#d(t,e=ds){if(!t||typeof t!="object"||t.type!==null||t.#t.length!==1||this.type===null)return!1;let n=t.#t[0];return!n||typeof n!="object"||n.type===null?!1:this.#p(n.type,e)}#p(t,e=ms){return!!e.get(this.type)?.includes(t)}#S(t,e){let n=t.#t[0],o=new T(null,n,this.options);o.#t.push(""),n.push(o),this.#g(t,e)}#g(t,e){let n=t.#t[0];this.#t.splice(e,1,...n.#t);for(let o of n.#t)typeof o=="object"&&(o.#e=this);this.#r=void 0}#x(t){return!!re.get(this.type)?.has(t)}#v(t){if(!t||typeof t!="object"||t.type!==null||t.#t.length!==1||this.type===null||this.#t.length!==1)return!1;let e=t.#t[0];return!e||typeof e!="object"||e.type===null?!1:this.#x(e.type)}#b(t){let e=re.get(this.type),n=t.#t[0],o=e?.get(n.type);if(!o)return!1;this.#t=n.#t;for(let i of this.#t)typeof i=="object"&&(i.#e=this);this.type=o,this.#r=void 0,this.#u=!1}static fromGlob(t,e={}){let n=new T(null,void 0,e);return T.#f(t,n,0,e,0),n}toMMPattern(){if(this!==this.#s)return this.#s.toMMPattern();let t=this.toString(),[e,n,o,i]=this.toRegExpSource();if(!(o||this.#n||this.#i.nocase&&!this.#i.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return n;let r=(this.#i.nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${e}$`,r),{_src:e,_glob:t})}get options(){return this.#i}toRegExpSource(t){let e=t??!!this.#i.dot;if(this.#s===this&&(this.#h(),this.#y()),!ie(this)){let u=this.isStart()&&this.isEnd()&&!this.#t.some(d=>typeof d!="string"),l=this.#t.map(d=>{let[g,h,x,S]=typeof d=="string"?T.#C(d,this.#n,u):d.toRegExpSource(t);return this.#n=this.#n||x,this.#o=this.#o||S,g}).join(""),f="";if(this.isStart()&&typeof this.#t[0]=="string"&&!(this.#t.length===1&&Ss.has(this.#t[0]))){let g=ws,h=e&&g.has(l.charAt(0))||l.startsWith("\\.")&&g.has(l.charAt(2))||l.startsWith("\\.\\.")&&g.has(l.charAt(4)),x=!e&&!t&&g.has(l.charAt(0));f=h?ys:x?pt:""}let c="";return this.isEnd()&&this.#s.#c&&this.#e?.type==="!"&&(c="(?:$|\\/)"),[f+l+c,G(l),this.#n=!!this.#n,this.#o]}let n=this.type==="*"||this.type==="+",o=this.type==="!"?"(?:(?!(?:":"(?:",i=this.#m(e);if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){let u=this.toString(),l=this;return l.#t=[u],l.type=null,l.#n=void 0,[u,G(this.toString()),!1,!1]}let a=!n||t||e||!pt?"":this.#m(!0);a===i&&(a=""),a&&(i=`(?:${i})(?:${a})*?`);let r="";if(this.type==="!"&&this.#u)r=(this.isStart()&&!e?pt:"")+ce;else{let u=this.type==="!"?"))"+(this.isStart()&&!e&&!t?pt:"")+ae+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;r=o+i+u}return[r,G(i),this.#n=!!this.#n,this.#o]}#h(){if(ie(this)){let t=0,e=!1;do{e=!0;for(let n=0;n<this.#t.length;n++){let o=this.#t[n];typeof o=="object"&&(o.#h(),this.#d(o)?(e=!1,this.#g(o,n)):this.#w(o)?(e=!1,this.#S(o,n)):this.#v(o)&&(e=!1,this.#b(o)))}}while(!e&&++t<10)}else for(let t of this.#t)typeof t=="object"&&t.#h();this.#r=void 0}#m(t){return this.#t.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[n,o,i,a]=e.toRegExpSource(t);return this.#o=this.#o||a,n}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#C(t,e,n=!1){let o=!1,i="",a=!1,r=!1;for(let u=0;u<t.length;u++){let l=t.charAt(u);if(o){o=!1,i+=(xs.has(l)?"\\":"")+l;continue}if(l==="*"){if(r)continue;r=!0,i+=n&&/^[*]+$/.test(t)?ce:ae,e=!0;continue}else r=!1;if(l==="\\"){u===t.length-1?i+="\\\\":o=!0;continue}if(l==="["){let[f,c,p,d]=ne(t,u);if(p){i+=f,a=a||c,u+=p-1,e=e||d;continue}}if(l==="?"){i+=Ot,e=!0;continue}i+=vs(l)}return[i,G(t),!!e,a]}};T=B});var At,Lt=N(()=>{At=(s,{windowsPathsNoEscape:t=!1,magicalBraces:e=!1}={})=>e?t?s.replace(/[?*()[\]{}]/g,"[$&]"):s.replace(/[?*()[\]\\{}]/g,"\\$&"):t?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&")});var E,Cs,Es,ks,Ps,Rs,Ts,Ms,Os,$s,As,Ls,Ns,js,Is,Ds,Fs,Gs,_s,fe,pe,he,le,Ws,P,Ks,Bs,Us,Hs,zs,$,qs,de,Js,Xs,ue,Ys,H,ge=N(()=>{te();ee();$t();Lt();ft();$t();Lt();ft();E=(s,t,e={})=>(Q(t),!e.nocomment&&t.charAt(0)==="#"?!1:new H(t,e).match(s)),Cs=/^\*+([^+@!?\*\[\(]*)$/,Es=s=>t=>!t.startsWith(".")&&t.endsWith(s),ks=s=>t=>t.endsWith(s),Ps=s=>(s=s.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(s)),Rs=s=>(s=s.toLowerCase(),t=>t.toLowerCase().endsWith(s)),Ts=/^\*+\.\*+$/,Ms=s=>!s.startsWith(".")&&s.includes("."),Os=s=>s!=="."&&s!==".."&&s.includes("."),$s=/^\.\*+$/,As=s=>s!=="."&&s!==".."&&s.startsWith("."),Ls=/^\*+$/,Ns=s=>s.length!==0&&!s.startsWith("."),js=s=>s.length!==0&&s!=="."&&s!=="..",Is=/^\?+([^+@!?\*\[\(]*)?$/,Ds=([s,t=""])=>{let e=fe([s]);return t?(t=t.toLowerCase(),n=>e(n)&&n.toLowerCase().endsWith(t)):e},Fs=([s,t=""])=>{let e=pe([s]);return t?(t=t.toLowerCase(),n=>e(n)&&n.toLowerCase().endsWith(t)):e},Gs=([s,t=""])=>{let e=pe([s]);return t?n=>e(n)&&n.endsWith(t):e},_s=([s,t=""])=>{let e=fe([s]);return t?n=>e(n)&&n.endsWith(t):e},fe=([s])=>{let t=s.length;return e=>e.length===t&&!e.startsWith(".")},pe=([s])=>{let t=s.length;return e=>e.length===t&&e!=="."&&e!==".."},he=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",le={win32:{sep:"\\"},posix:{sep:"/"}},Ws=he==="win32"?le.win32.sep:le.posix.sep;E.sep=Ws;P=Symbol("globstar **");E.GLOBSTAR=P;Ks="[^/]",Bs=Ks+"*?",Us="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Hs="(?:(?!(?:\\/|^)\\.).)*?",zs=(s,t={})=>e=>E(e,s,t);E.filter=zs;$=(s,t={})=>Object.assign({},s,t),qs=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return E;let t=E;return Object.assign((n,o,i={})=>t(n,o,$(s,i)),{Minimatch:class extends t.Minimatch{constructor(o,i={}){super(o,$(s,i))}static defaults(o){return t.defaults($(s,o)).Minimatch}},AST:class extends t.AST{constructor(o,i,a={}){super(o,i,$(s,a))}static fromGlob(o,i={}){return t.AST.fromGlob(o,$(s,i))}},unescape:(n,o={})=>t.unescape(n,$(s,o)),escape:(n,o={})=>t.escape(n,$(s,o)),filter:(n,o={})=>t.filter(n,$(s,o)),defaults:n=>t.defaults($(s,n)),makeRe:(n,o={})=>t.makeRe(n,$(s,o)),braceExpand:(n,o={})=>t.braceExpand(n,$(s,o)),match:(n,o,i={})=>t.match(n,o,$(s,i)),sep:t.sep,GLOBSTAR:P})};E.defaults=qs;de=(s,t={})=>(Q(s),t.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:Zt(s,{max:t.braceExpandMax}));E.braceExpand=de;Js=(s,t={})=>new H(s,t).makeRe();E.makeRe=Js;Xs=(s,t,e={})=>{let n=new H(t,e);return s=s.filter(o=>n.match(o)),n.options.nonull&&!s.length&&s.push(t),s};E.match=Xs;ue=/[?*]|[+@!]\(.*?\)|\[|\]/,Ys=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),H=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;maxGlobstarRecursion;regexp;constructor(t,e={}){Q(t),e=e||{},this.options=e,this.maxGlobstarRecursion=e.maxGlobstarRecursion??200,this.pattern=t,this.platform=e.platform||he,this.isWindows=this.platform==="win32";let n="allowWindowsEscape";this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e[n]===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);let n=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let o=this.globParts.map((i,a,r)=>{if(this.isWindows&&this.windowsNoMagicRoot){let u=i[0]===""&&i[1]===""&&(i[2]==="?"||!ue.test(i[2]))&&!ue.test(i[3]),l=/^[a-z]:/i.test(i[0]);if(u)return[...i.slice(0,4),...i.slice(4).map(f=>this.parse(f))];if(l)return[i[0],...i.slice(1).map(f=>this.parse(f))]}return i.map(u=>this.parse(u))});if(this.debug(this.pattern,o),this.set=o.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){let a=this.set[i];a[0]===""&&a[1]===""&&this.globParts[i][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let n=0;n<t.length;n++)for(let o=0;o<t[n].length;o++)t[n][o]==="**"&&(t[n][o]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let n=-1;for(;(n=e.indexOf("**",n+1))!==-1;){let o=n;for(;e[o+1]==="**";)o++;o!==n&&e.splice(n,o-n)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((n,o)=>{let i=n[n.length-1];return o==="**"&&i==="**"?n:o===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(n.pop(),n):(n.push(o),n)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let o=1;o<t.length-1;o++){let i=t[o];o===1&&i===""&&t[0]===""||(i==="."||i==="")&&(e=!0,t.splice(o,1),o--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let n=0;for(;(n=t.indexOf("..",n+1))!==-1;){let o=t[n-1];o&&o!=="."&&o!==".."&&o!=="**"&&(e=!0,t.splice(n-1,2),n-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let n of t){let o=-1;for(;(o=n.indexOf("**",o+1))!==-1;){let a=o;for(;n[a+1]==="**";)a++;a>o&&n.splice(o+1,a-o);let r=n[o+1],u=n[o+2],l=n[o+3];if(r!==".."||!u||u==="."||u===".."||!l||l==="."||l==="..")continue;e=!0,n.splice(o,1);let f=n.slice(0);f[o]="**",t.push(f),o--}if(!this.preserveMultipleSlashes){for(let a=1;a<n.length-1;a++){let r=n[a];a===1&&r===""&&n[0]===""||(r==="."||r==="")&&(e=!0,n.splice(a,1),a--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(e=!0,n.pop())}let i=0;for(;(i=n.indexOf("..",i+1))!==-1;){let a=n[i-1];if(a&&a!=="."&&a!==".."&&a!=="**"){e=!0;let u=i===1&&n[i+1]==="**"?["."]:[];n.splice(i-1,2,...u),n.length===0&&n.push(""),i-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let n=e+1;n<t.length;n++){let o=this.partsMatch(t[e],t[n],!this.preserveMultipleSlashes);if(o){t[e]=[],t[n]=o;break}}return t.filter(e=>e.length)}partsMatch(t,e,n=!1){let o=0,i=0,a=[],r="";for(;o<t.length&&i<e.length;)if(t[o]===e[i])a.push(r==="b"?e[i]:t[o]),o++,i++;else if(n&&t[o]==="**"&&e[i]===t[o+1])a.push(t[o]),o++;else if(n&&e[i]==="**"&&t[o]===e[i+1])a.push(e[i]),i++;else if(t[o]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(r==="b")return!1;r="a",a.push(t[o]),o++,i++}else if(e[i]==="*"&&t[o]&&(this.options.dot||!t[o].startsWith("."))&&t[o]!=="**"){if(r==="a")return!1;r="b",a.push(e[i]),o++,i++}else return!1;return t.length===e.length&&a}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,n=0;for(let o=0;o<t.length&&t.charAt(o)==="!";o++)e=!e,n++;n&&(this.pattern=t.slice(n)),this.negate=e}matchOne(t,e,n=!1){let o=0,i=0;if(this.isWindows){let r=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),u=!r&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),l=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),f=!l&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),c=u?3:r?0:void 0,p=f?3:l?0:void 0;if(typeof c=="number"&&typeof p=="number"){let[d,g]=[t[c],e[p]];d.toLowerCase()===g.toLowerCase()&&(e[p]=d,i=p,o=c)}}let{optimizationLevel:a=1}=this.options;return a>=2&&(t=this.levelTwoFileOptimize(t)),e.includes(P)?this.#s(t,e,n,o,i):this.#o(t,e,n,o,i)}#s(t,e,n,o,i){let a=e.indexOf(P,i),r=e.lastIndexOf(P),[u,l,f]=n?[e.slice(i,a),e.slice(a+1),[]]:[e.slice(i,a),e.slice(a+1,r),e.slice(r+1)];if(u.length){let m=t.slice(o,o+u.length);if(!this.#o(m,u,n,0,0))return!1;o+=u.length,i+=u.length}let c=0;if(f.length){if(f.length+o>t.length)return!1;let m=t.length-f.length;if(this.#o(t,f,n,m,0))c=f.length;else{if(t[t.length-1]!==""||o+f.length===t.length||(m--,!this.#o(t,f,n,m,0)))return!1;c=f.length+1}}if(!l.length){let m=!!c;for(let b=o;b<t.length-c;b++){let y=String(t[b]);if(m=!0,y==="."||y===".."||!this.options.dot&&y.startsWith("."))return!1}return n||m}let p=[[[],0]],d=p[0],g=0,h=[0];for(let m of l)m===P?(h.push(g),d=[[],0],p.push(d)):(d[0].push(m),g++);let x=p.length-1,S=t.length-c;for(let m of p)m[1]=S-(h[x--]+m[0].length);return!!this.#n(t,p,o,0,n,0,!!c)}#n(t,e,n,o,i,a,r){let u=e[o];if(!u){for(let c=n;c<t.length;c++){r=!0;let p=t[c];if(p==="."||p===".."||!this.options.dot&&p.startsWith("."))return!1}return r}let[l,f]=u;for(;n<=f;){if(this.#o(t.slice(0,n+l.length),l,i,n,0)&&a<this.maxGlobstarRecursion){let d=this.#n(t,e,n+l.length,o+1,i,a+1,r);if(d!==!1)return d}let p=t[n];if(p==="."||p===".."||!this.options.dot&&p.startsWith("."))return!1;n++}return i||null}#o(t,e,n,o,i){let a,r,u,l;for(a=o,r=i,l=t.length,u=e.length;a<l&&r<u;a++,r++){this.debug("matchOne loop");let f=e[r],c=t[a];if(this.debug(e,f,c),f===!1||f===P)return!1;let p;if(typeof f=="string"?(p=c===f,this.debug("string match",f,c,p)):(p=f.test(c),this.debug("pattern match",f,c,p)),!p)return!1}if(a===l&&r===u)return!0;if(a===l)return n;if(r===u)return a===l-1&&t[a]==="";throw new Error("wtf?")}braceExpand(){return de(this.pattern,this.options)}parse(t){Q(t);let e=this.options;if(t==="**")return P;if(t==="")return"";let n,o=null;(n=t.match(Ls))?o=e.dot?js:Ns:(n=t.match(Cs))?o=(e.nocase?e.dot?Rs:Ps:e.dot?ks:Es)(n[1]):(n=t.match(Is))?o=(e.nocase?e.dot?Fs:Ds:e.dot?Gs:_s)(n):(n=t.match(Ts))?o=e.dot?Os:Ms:(n=t.match($s))&&(o=As);let i=B.fromGlob(t,this.options).toMMPattern();return o&&typeof i=="object"&&Reflect.defineProperty(i,"test",{value:o}),i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,n=e.noglobstar?Bs:e.dot?Us:Hs,o=new Set(e.nocase?["i"]:[]),i=t.map(u=>{let l=u.map(c=>{if(c instanceof RegExp)for(let p of c.flags.split(""))o.add(p);return typeof c=="string"?Ys(c):c===P?P:c._src});l.forEach((c,p)=>{let d=l[p+1],g=l[p-1];c!==P||g===P||(g===void 0?d!==void 0&&d!==P?l[p+1]="(?:\\/|"+n+"\\/)?"+d:l[p]=n:d===void 0?l[p-1]=g+"(?:\\/|\\/"+n+")?":d!==P&&(l[p-1]=g+"(?:\\/|\\/"+n+"\\/)"+d,l[p+1]=P))});let f=l.filter(c=>c!==P);if(this.partial&&f.length>=1){let c=[];for(let p=1;p<=f.length;p++)c.push(f.slice(0,p).join("/"));return"(?:"+c.join("|")+")"}return f.join("/")}).join("|"),[a,r]=t.length>1?["(?:",")"]:["",""];i="^"+a+i+r+"$",this.partial&&(i="^(?:\\/|"+a+i.slice(1,-1)+r+")$"),this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let n=this.options;this.isWindows&&(t=t.split("\\").join("/"));let o=this.slashSplit(t);this.debug(this.pattern,"split",o);let i=this.set;this.debug(this.pattern,"set",i);let a=o[o.length-1];if(!a)for(let r=o.length-2;!a&&r>=0;r--)a=o[r];for(let r=0;r<i.length;r++){let u=i[r],l=o;if(n.matchBase&&u.length===1&&(l=[a]),this.matchOne(l,u,e))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(t){return E.defaults(t).Minimatch}};E.AST=B;E.Minimatch=H;E.escape=At;E.unescape=G});var xe={};_t(xe,{enumerateSyncFiles:()=>tt,getDefaultEnabledPaths:()=>Se,gistFileNameToSyncKey:()=>jt,resolveSyncRoots:()=>ht,syncKeyToGistFileName:()=>Nt});function ht(s=process.platform){if(s==="win32"){let e=process.env.APPDATA||M.join(z.homedir(),"AppData","Roaming"),n=process.env.USERPROFILE||z.homedir();return{cursorUser:M.join(e,"Cursor","User"),dotCursor:M.join(n,".cursor")}}if(s==="darwin"){let e=z.homedir();return{cursorUser:M.join(e,"Library","Application Support","Cursor","User"),dotCursor:M.join(e,".cursor")}}let t=process.env.XDG_CONFIG_HOME||M.join(z.homedir(),".config");return{cursorUser:M.join(t,"Cursor","User"),dotCursor:M.join(z.homedir(),".cursor")}}async function tt(s){let t=s??ht(),e=ye.workspace.getConfiguration("cursorSync"),n=e.get("enabledPaths")??Se(),o=e.get("excludeGlobs")??[],a=(e.get("maxFileSizeKB")??512)*1024,r=n.filter(f=>f==="settings.json"||f==="keybindings.json"||f==="extensions.json"||f.startsWith("snippets")),u=n.filter(f=>f.startsWith("skills")||f.startsWith("commands")||f.startsWith("rules")),l=[];return await me(t.cursorUser,"cursor-user",r,o,a,l),await me(t.dotCursor,"dot-cursor",u,o,a,l),l.sort((f,c)=>f.relativeSyncKey.localeCompare(c.relativeSyncKey))}async function me(s,t,e,n,o,i){if(!await en(s))return;let r=await we(s);for(let u of r){let l=M.relative(s,u).split(M.sep).join("/");if(!(tn(l)||!e.some(p=>E(l,p))||n.some(p=>E(l,p)))){try{if((await Z.stat(u)).size>o)continue}catch{continue}i.push({absolutePath:u,relativeSyncKey:`${t}/${l}`})}}}function tn(s){let t=s.split("/"),e=t[0];if(e&&Qs.includes(e))return!0;let n=t[t.length-1];if(n&&Vs.includes(n))return!0;if(n){for(let o of Zs)if(E(n,o))return!0}return!1}async function we(s){let t=[],e;try{e=await Z.readdir(s,{withFileTypes:!0})}catch{return t}for(let n of e){let o=M.join(s,n.name);if(n.isDirectory()){let i=await we(o);t.push(...i)}else n.isFile()&&t.push(o)}return t}async function en(s){try{return(await Z.stat(s)).isDirectory()}catch{return!1}}function Se(){return["settings.json","keybindings.json","snippets/**","extensions.json","skills/**/SKILL.md","skills-cursor/**/SKILL.md","commands/**/*.md","rules/*.mdc"]}function Nt(s){return s.replace(/\//g,"--")}function jt(s){return s.replace(/--/g,"/")}var M,Z,z,ye,Qs,Vs,Zs,et=N(()=>{"use strict";M=v(require("node:path")),Z=v(require("node:fs/promises")),z=v(require("node:os")),ye=v(require("vscode"));ge();Qs=["extensions","logs","CachedData","CachedExtensions","CachedProfilesData","Crashpad","DawnCache","GPUCache","blob_storage","Local Storage","Session Storage","Network","shared_proto_db","databases"],Vs=["TransportSecurity"],Zs=["Cookies*","*.db","*.db-journal","*.db-wal","*.log"]});var gn={};_t(gn,{activate:()=>pn,deactivate:()=>hn});module.exports=Ke(gn);var F=v(require("vscode"));var D=v(require("vscode"));var Be="https://api.github.com",Ue="cursor-sync-extension",j=class{pat;constructor(t){this.pat=t}async validateToken(){return this.request("GET","/gists?per_page=1",void 0,()=>!0)}async getGist(t){return this.request("GET",`/gists/${t}`)}async createGist(t,e){return this.request("POST","/gists",{description:e,public:!1,files:t})}async updateGist(t,e){return this.request("PATCH",`/gists/${t}`,{files:e})}async request(t,e,n,o){let i=`${Be}${e}`,a={Authorization:`token ${this.pat}`,Accept:"application/vnd.github.v3+json","User-Agent":Ue};n&&(a["Content-Type"]="application/json");let r;try{r=await fetch(i,{method:t,headers:a,body:n?JSON.stringify(n):void 0})}catch(f){return{ok:!1,error:{category:"NETWORK_ERROR",message:f instanceof Error?f.message:"Network request failed"}}}let u=r.headers.get("X-RateLimit-Remaining"),l=r.headers.get("Retry-After");if(r.status===429)return{ok:!1,error:{category:"RATE_LIMITED",message:"GitHub API rate limit exceeded",statusCode:429,retryAfter:l?parseInt(l,10):60}};if(r.status===401||r.status===403)return{ok:!1,error:{category:"AUTH_FAILED",message:`Authentication failed (${r.status})`,statusCode:r.status}};if(r.status>=500)return{ok:!1,error:{category:"NETWORK_ERROR",message:`Server error (${r.status})`,statusCode:r.status}};if(!r.ok){let f=`GitHub API error (${r.status})`;try{let c=await r.json();c.message&&(f=c.message)}catch{}return{ok:!1,error:{category:"UNKNOWN",message:f,statusCode:r.status}}}try{let f=await r.json();return{ok:!0,data:o?o(f):f}}catch{return{ok:!1,error:{category:"UNKNOWN",message:"Failed to parse response JSON"}}}}};var He=new Set([401,403,404,422]);async function I(s){let t;for(let e=0;e<3;e++){let n=await s();if(n.ok||(t=n.error,n.error.statusCode&&He.has(n.error.statusCode)))return n;if(e<2){let o=n.error.retryAfter?n.error.retryAfter*1e3:1e3*Math.pow(3,e);await ze(o)}}return{ok:!1,error:t??{category:"UNKNOWN",message:"All retry attempts exhausted"}}}function ze(s){return new Promise(t=>setTimeout(t,s))}var ct=v(require("vscode")),U=v(require("node:fs/promises")),lt=v(require("node:path")),Et;function k(){return Et||(Et=ct.window.createOutputChannel("Cursor Sync")),Et}async function Kt(s){let t=await K(s),e=[];if(!t){e.push({label:"Status",description:"No sync performed yet"}),ct.window.showQuickPick(e,{title:"Cursor Sync Status"});return}e.push({label:"Last Sync",description:t.lastSyncTimestamp}),e.push({label:"Direction",description:t.lastSyncDirection}),e.push({label:"Gist ID",description:t.gistId}),e.push({label:"Gist URL",description:`https://gist.github.com/${t.gistId}`}),e.push({label:"Files Synced",description:String(Object.keys(t.localChecksums).length)}),ct.window.showQuickPick(e,{title:"Cursor Sync Status"})}function Bt(s){return lt.join(s.globalStorageUri.fsPath,"sync-state.json")}async function K(s){let t=Bt(s);try{let e=await U.readFile(t,"utf-8");return JSON.parse(e)}catch{return}}async function ut(s,t){let e=Bt(s),n=lt.dirname(e);await U.mkdir(n,{recursive:!0}),await U.writeFile(e,JSON.stringify(t,null,2),"utf-8")}var Ut="cursorSync.githubPAT";async function kt(s){let t=k(),e=await D.window.showInputBox({prompt:"Enter your GitHub Personal Access Token (requires gist scope)",password:!0,ignoreFocusOut:!0,placeHolder:"ghp_xxxxxxxxxxxx",validateInput:i=>{if(!i||i.trim().length===0)return"Token cannot be empty"}});if(!e)return;let n=new j(e.trim()),o=await I(()=>n.validateToken());if(!o.ok){t.appendLine(`[${new Date().toISOString()}] Token validation failed: ${o.error.message}`),D.window.showErrorMessage(`GitHub token validation failed: ${o.error.message}`);return}await s.secrets.store(Ut,e.trim()),await D.commands.executeCommand("setContext","cursorSync.configured",!0),D.window.showInformationMessage("GitHub token configured successfully."),t.appendLine(`[${new Date().toISOString()}] GitHub token configured`)}async function J(s){return s.secrets.get(Ut)}async function X(s){let t=await J(s);return t||(await D.window.showWarningMessage("GitHub token not configured. Configure now?","Configure")==="Configure"?(await kt(s),J(s)):void 0)}async function Ht(s){let t=await J(s);if(!t)return!1;let e=new j(t);return(await I(()=>e.validateToken())).ok?!0:(D.window.showErrorMessage("Stored GitHub token is no longer valid. Please reconfigure."),await D.commands.executeCommand("setContext","cursorSync.configured",!1),!1)}var W=v(require("vscode")),xt=v(require("node:fs/promises"));et();var dt=v(require("node:crypto")),ve=v(require("node:fs/promises")),gt=v(require("node:os"));async function be(s,t){let e=[...s].sort((a,r)=>a.relativeSyncKey.localeCompare(r.relativeSyncKey)),n=new Map,o={};for(let a of e){let r=await ve.readFile(a.absolutePath),u=nn(r),l=u?r.toString("utf-8"):r.toString("base64"),f=dt.createHash("sha256").update(r).digest("hex"),c=r.length,p={content:l,checksum:f,sizeBytes:c},d={checksum:f,sizeBytes:c};u||(p.encoding="base64",d.encoding="base64"),n.set(a.relativeSyncKey,p),o[a.relativeSyncKey]=d}let i={schemaVersion:1,syncProfileName:t,createdAt:new Date().toISOString(),sourceMachineId:sn(),sourceOS:process.platform,files:o};return{packaged:n,manifest:i}}function mt(s){return dt.createHash("sha256").update(s).digest("hex")}function sn(){let s=`${gt.hostname()}:${gt.userInfo().username}`;return dt.createHash("sha256").update(s).digest("hex")}function nn(s){try{return new TextDecoder("utf-8",{fatal:!0}).decode(s)!==void 0}catch{return!1}}var _=v(require("vscode")),Ce=v(require("node:fs/promises"));et();var It=[],st=[];function yt(){st=[],It=[],_.commands.executeCommand("setContext","cursorSync.hasConflicts",!1)}async function wt(s,t){let e=await K(s);if(!e)return[];let n=await tt(),o={};for(let r of n)try{let u=await Ce.readFile(r.absolutePath);o[r.relativeSyncKey]=mt(u)}catch{continue}let i=[],a=new Set([...Object.keys(o),...Object.keys(t)]);for(let r of a){let u=e.localChecksums[r],l=e.remoteChecksums[r],f=o[r],c=t[r];if(!u||!l)continue;f!==u&&c!==l&&f!==c&&i.push({relativeSyncKey:r,localChecksum:f??"",remoteChecksum:c??"",baseChecksum:u})}return i.length>0&&(st=i,await _.commands.executeCommand("setContext","cursorSync.hasConflicts",!0)),i}async function Ee(s){let t=k();if(st.length===0){_.window.showInformationMessage("No conflicts to resolve.");return}let e=[];for(let o of st){let i=await _.window.showQuickPick([{label:"Keep Local",value:"keepLocal"},{label:"Keep Remote",value:"keepRemote"},{label:"Skip (decide later)",value:"skip"}],{title:`Conflict: ${o.relativeSyncKey}`,placeHolder:"Choose which version to keep"});if(!i)return;e.push({relativeSyncKey:o.relativeSyncKey,resolution:i.value})}It=e,e.some(o=>o.resolution==="skip")||(st=[],await _.commands.executeCommand("setContext","cursorSync.hasConflicts",!1)),t.appendLine(`[${new Date().toISOString()}] Conflicts resolved: ${e.length} decisions`),_.window.showInformationMessage(`Resolved ${e.length} conflict(s). You can now push or pull.`)}function nt(s){return It.find(e=>e.relativeSyncKey===s)?.resolution}var ot=v(require("vscode"));function ke(){let s=ot.extensions.all,t=[];for(let e of s){if(e.id.startsWith("vscode."))continue;let n=e.extensionKind;ot.ExtensionKind.UI,t.push({id:e.id,version:e.packageJSON?.version??"0.0.0"})}return t.sort((e,n)=>e.id.localeCompare(n.id)),JSON.stringify(t,null,2)}function Pe(s){let t=new Set(ot.extensions.all.filter(e=>!e.id.startsWith("vscode.")).map(e=>e.id.toLowerCase()));return s.filter(e=>!t.has(e.id.toLowerCase()))}var St=!1;function Re(){return St}async function vt(s){let t=k();if(St)return W.window.showWarningMessage("A sync operation is already in progress."),!1;St=!0;try{return await on(s)}finally{St=!1}}async function on(s){let t=k();if(t.appendLine(`[${new Date().toISOString()}] Push started`),!await Ht(s)&&!await X(s))return t.appendLine(`[${new Date().toISOString()}] Push failed: AUTH_FAILED`),!1;let e=await X(s);if(!e)return!1;let n=new j(e),o=await K(s);if(o){let m=o.remoteChecksums,b=await wt(s,m);if(b.length>0){let y=b.filter(w=>{let C=nt(w.relativeSyncKey);return!C||C==="skip"});if(y.length>0)return W.window.showWarningMessage(`${y.length} conflict(s) detected. Resolve them before pushing.`),t.appendLine(`[${new Date().toISOString()}] Push blocked: CONFLICT`),!1}}let i=ke(),a=(await Promise.resolve().then(()=>(et(),xe))).resolveSyncRoots().cursorUser,r=await rn(a,i),u=await tt(),f=W.workspace.getConfiguration("cursorSync").get("syncProfileName")??"default",{packaged:c,manifest:p}=await be(u,f),d={};d["manifest.json"]={content:JSON.stringify(p,null,2)};for(let[m,b]of c){let y=Nt(m);d[y]={content:b.content}}let g=o?.gistId;if(g){let m=await I(()=>n.getGist(g)),b={};if(m.ok){let C=Object.keys(m.data.files);for(let R of C)R!=="manifest.json"&&!d[R]&&(b[R]=null)}let y={...d,...b},w=await I(()=>n.updateGist(g,y));if(!w.ok)return W.window.showErrorMessage(`Push failed: ${w.error.message}`),t.appendLine(`[${new Date().toISOString()}] Push failed: ${w.error.category} - ${w.error.message}`),!1}else{let m=await I(()=>n.createGist(d,"Cursor Sync - Settings Backup"));if(!m.ok)return W.window.showErrorMessage(`Push failed: ${m.error.message}`),t.appendLine(`[${new Date().toISOString()}] Push failed: ${m.error.category} - ${m.error.message}`),!1;g=m.data.id}let h={};for(let[m,b]of c)h[m]=b.checksum;let x={lastSyncTimestamp:new Date().toISOString(),lastSyncDirection:"push",gistId:g,localChecksums:h,remoteChecksums:h};await ut(s,x),yt();let S=c.size;return W.window.showInformationMessage(`Push complete: ${S} file(s) synced.`),t.appendLine(`[${new Date().toISOString()}] Push succeeded: ${S} files`),!0}async function rn(s,t){let e=(await import("node:path")).join(s,"extensions.json"),n=(await import("node:path")).dirname(e);return await xt.mkdir(n,{recursive:!0}),await xt.writeFile(e,t,"utf-8"),e}var O=v(require("vscode")),q=v(require("node:fs/promises")),rt=v(require("node:path"));et();var A=v(require("node:fs/promises")),it=v(require("node:path"));var Te=3;async function Me(s,t){let e=new Date().toISOString().replace(/[:.]/g,"-"),n=it.join(s.globalStorageUri.fsPath,"backups",e);await A.mkdir(n,{recursive:!0});let o=[];for(let i of t)try{await A.access(i);let a=i.replace(/[/\\]/g,"--"),r=it.join(n,a);await A.copyFile(i,r),o.push({absolutePath:i,backupPath:r})}catch{}return{backupDir:n,entries:o}}async function Oe(s){let t=k();for(let e of s)try{await A.copyFile(e.backupPath,e.absolutePath)}catch(n){t.appendLine(`[${new Date().toISOString()}] Rollback failed for ${e.absolutePath}: ${n instanceof Error?n.message:String(n)}`)}}async function $e(s){let t=it.join(s.globalStorageUri.fsPath,"backups"),e;try{e=await A.readdir(t)}catch{return}if(e.sort(),e.length<=Te)return;let n=e.slice(0,e.length-Te);for(let o of n)try{await A.rm(it.join(t,o),{recursive:!0,force:!0})}catch{}}var Dt=!1;async function Ae(s){let t=k();if(Dt)return O.window.showWarningMessage("A sync operation is already in progress."),!1;Dt=!0;try{return await an(s)}finally{Dt=!1}}async function an(s){let t=k();t.appendLine(`[${new Date().toISOString()}] Pull started`);let e=await K(s);if(!e?.gistId)return O.window.showErrorMessage("Not configured. Push first or configure a Gist ID."),t.appendLine(`[${new Date().toISOString()}] Pull failed: not configured`),!1;let n=await X(s);if(!n)return!1;let o=new j(n),i=await I(()=>o.getGist(e.gistId));if(!i.ok)return O.window.showErrorMessage(`Pull failed: ${i.error.message}`),t.appendLine(`[${new Date().toISOString()}] Pull failed: ${i.error.category} - ${i.error.message}`),!1;let a=i.data,r=a.files["manifest.json"];if(!r)return O.window.showErrorMessage("Pull failed: manifest.json not found in Gist."),t.appendLine(`[${new Date().toISOString()}] Pull failed: missing manifest`),!1;let u;try{u=JSON.parse(r.content)}catch{return O.window.showErrorMessage("Pull failed: invalid manifest.json."),t.appendLine(`[${new Date().toISOString()}] Pull failed: invalid manifest`),!1}let l={};for(let[y,w]of Object.entries(u.files))l[y]=w.checksum;let f=await wt(s,l);if(f.length>0){let y=f.filter(w=>{let C=nt(w.relativeSyncKey);return!C||C==="skip"});if(y.length>0)return O.window.showWarningMessage(`${y.length} conflict(s) detected. Resolve them before pulling.`),t.appendLine(`[${new Date().toISOString()}] Pull blocked: CONFLICT`),!1}let c=ht(),p=[];for(let[y,w]of Object.entries(a.files)){if(y==="manifest.json")continue;let C=jt(y),R=u.files[C];if(!R||f.length>0&&nt(C)==="keepLocal")continue;let L=cn(C,c);if(!L)continue;let Ie=R.encoding==="base64"?Buffer.from(w.content,"base64"):Buffer.from(w.content,"utf-8");p.push({absolutePath:L,syncKey:C,content:Ie})}if((O.workspace.getConfiguration("cursorSync").get("safeMode")??!0)&&p.length>0){let y=p.map(L=>({label:L.syncKey,picked:!0})),w=await O.window.showQuickPick(y,{canPickMany:!0,title:"Files to overwrite",placeHolder:"Deselect files you do not want to overwrite"});if(!w)return t.appendLine(`[${new Date().toISOString()}] Pull cancelled by user`),!1;let C=new Set(w.map(L=>L.label)),R=p.filter(L=>C.has(L.syncKey));p.length=0,p.push(...R)}if(p.length===0)return O.window.showInformationMessage("Pull complete: no files to update."),!0;let{entries:h}=await Me(s,p.map(y=>y.absolutePath)),x=[],S=!1;for(let y of p)try{let w=rt.dirname(y.absolutePath);await q.mkdir(w,{recursive:!0});let C=y.absolutePath+".tmp";await q.writeFile(C,y.content),await q.rename(C,y.absolutePath);let R=h.find(L=>L.absolutePath===y.absolutePath);R&&x.push(R)}catch(w){t.appendLine(`[${new Date().toISOString()}] Write failed for ${y.absolutePath}: ${w instanceof Error?w.message:String(w)}`),S=!0;break}if(S)return t.appendLine(`[${new Date().toISOString()}] Rolling back partial writes`),await Oe(x),O.window.showErrorMessage("Pull failed: file write error. Changes have been rolled back."),t.appendLine(`[${new Date().toISOString()}] Pull failed: FILE_SYSTEM_ERROR`),!1;await $e(s);let m={};for(let y of p)m[y.syncKey]=mt(y.content);let b={lastSyncTimestamp:new Date().toISOString(),lastSyncDirection:"pull",gistId:e.gistId,localChecksums:{...e.localChecksums,...m},remoteChecksums:l};return await ut(s,b),yt(),ln(a.files),O.window.showInformationMessage(`Pull complete: ${p.length} file(s) updated.`),t.appendLine(`[${new Date().toISOString()}] Pull succeeded: ${p.length} files`),!0}function cn(s,t){if(s.startsWith("cursor-user/")){let e=s.slice(12);return rt.join(t.cursorUser,...e.split("/"))}if(s.startsWith("dot-cursor/")){let e=s.slice(11);return rt.join(t.dotCursor,...e.split("/"))}}function ln(s){let t=s["cursor-user--extensions.json"];if(t)try{let e=JSON.parse(t.content),n=Pe(e);if(n.length>0){let o=n.map(i=>i.id).join(", ");O.window.showInformationMessage(`Extensions present remotely but not installed locally: ${o}`)}}catch{}}var Ne=v(require("vscode"));var un=5,fn=6e4,bt,Ct;function Ft(s){let t=Ne.workspace.getConfiguration("cursorSync");if(!(t.get("schedule.enabled")??!1))return;let n=Math.max(t.get("schedule.intervalMin")??30,un),o=n*60*1e3,i=Math.floor(Math.random()*fn);k().appendLine(`[${new Date().toISOString()}] Scheduler starting: interval=${n}min, jitter=${i}ms`),Ct=setTimeout(()=>{Le(s),bt=setInterval(()=>Le(s),o)},i)}function Gt(){Ct&&(clearTimeout(Ct),Ct=void 0),bt&&(clearInterval(bt),bt=void 0)}async function Le(s){let t=k();if(Re()){t.appendLine(`[${new Date().toISOString()}] Scheduled sync skipped: operation in progress`);return}t.appendLine(`[${new Date().toISOString()}] Scheduled sync triggered`);try{await vt(s)}catch(e){t.appendLine(`[${new Date().toISOString()}] Scheduled sync failed: ${e instanceof Error?e.message:String(e)}`)}}var je;function pn(s){let t=k();s.subscriptions.push(F.commands.registerCommand("cursorSync.configureGithub",()=>kt(s))),s.subscriptions.push(F.commands.registerCommand("cursorSync.push",()=>vt(s))),s.subscriptions.push(F.commands.registerCommand("cursorSync.pull",()=>Ae(s))),s.subscriptions.push(F.commands.registerCommand("cursorSync.showStatus",()=>Kt(s))),s.subscriptions.push(F.commands.registerCommand("cursorSync.resolveConflicts",()=>Ee(s))),dn(s),Ft(s),je=F.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("cursorSync.schedule")&&(Gt(),Ft(s))}),s.subscriptions.push(je),t.appendLine(`[${new Date().toISOString()}] Cursor Sync activated`)}function hn(){Gt()}async function dn(s){let t=await J(s);await F.commands.executeCommand("setContext","cursorSync.configured",t!==void 0)}0&&(module.exports={activate,deactivate});
//# sourceMappingURL=extension.js.map
